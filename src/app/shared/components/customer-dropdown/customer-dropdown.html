<div class="relative w-full">
  <button
    type="button"
    class="flex h-10 w-full items-center justify-between rounded-lg border border-gray-200 bg-gray-50 px-3 text-sm text-gray-700 transition-colors hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60"
    [disabled]="disabled()"
    (click)="toggle()"
  >
    <span class="truncate">{{ selectedLabel() }}</span>
    <app-icon
      name="icon-forward"
      [class]="'h-4 w-4 transition-transform ' + (isOpen() ? '-rotate-90' : 'rotate-90')"
    />
  </button>

  @if (isOpen()) {
    <div class="absolute top-full right-0 left-0 z-30 mt-2 w-full rounded-lg border border-gray-200 bg-white p-2 shadow-xl">
      <label
        class="mb-2 flex w-full items-center gap-2 rounded-lg bg-gray-50 px-3 py-2 transition-colors focus-within:bg-white focus-within:ring-2 focus-within:ring-gray-200"
      >
        <app-icon
          name="icon-search"
          [class]="'h-4 w-4 shrink-0 opacity-40'"
          [fill]="'currentColor'"
        />
        <input
          type="search"
          class="grow bg-transparent text-sm placeholder-gray-500 focus:caret-[#047857] focus:outline-none"
          [placeholder]="placeholder()"
          [value]="searchTerm()"
          (input)="onSearchInput($event)"
        />
      </label>

      <div class="max-h-48 overflow-y-auto">
        <button
          type="button"
          class="flex w-full cursor-pointer items-center rounded-md px-2 py-2 text-left text-sm transition-colors hover:bg-gray-100"
          (click)="select(null)"
        >
          {{ walkInLabel() }}
        </button>

        @for (option of filteredOptions(); track option.id) {
          <button
            type="button"
            class="flex w-full cursor-pointer items-center rounded-md px-2 py-2 text-left text-sm transition-colors hover:bg-gray-100"
            (click)="select(option.id)"
          >
            {{ option.label }}
          </button>
        }

        @if (!filteredOptions().length) {
          <div class="px-2 py-2 text-sm text-gray-500">No customers found</div>
        }
      </div>
    </div>
  }
</div>

