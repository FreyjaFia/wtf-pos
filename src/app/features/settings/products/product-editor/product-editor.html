<div class="p-6">
  <!-- Header -->
  <div class="mb-6 flex items-center gap-4">
    <button class="btn btn-ghost btn-sm" (click)="navigateToList()">
      <app-icon name="icon-back" [class]="'h-5 w-5'"></app-icon>
      Back
    </button>
    <h1 class="text-3xl font-bold">
      {{ isEditMode() ? 'Edit Product' : 'New Product' }}
    </h1>
  </div>

  <!-- Error Alert -->
  @if (error()) {
    <div class="alert alert-error mb-6">
      <app-icon name="icon-error" [class]="'h-6 w-6'"></app-icon>
      <span>{{ error() }}</span>
    </div>
  }

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="flex justify-center py-12">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
  }

  <!-- Form -->
  @if (!isLoading()) {
    <div class="card bg-base-100 max-w-2xl shadow-md">
      <div class="card-body">
        <form [formGroup]="productForm" (ngSubmit)="saveProduct()">
          <!-- Name -->
          <div class="form-control mb-4">
            <label class="label" for="productName">
              <span class="label-text font-medium"
                >Product Name <span class="text-error">*</span></span
              >
            </label>
            <input
              id="productName"
              type="text"
              formControlName="name"
              placeholder="Enter product name"
              class="input input-bordered"
              [class.input-error]="hasError('name')"
            />
            @if (getErrorMessage('name')) {
              <div class="label">
                <span class="label-text-alt text-error">{{ getErrorMessage('name') }}</span>
              </div>
            }
          </div>

          <!-- Price -->
          <div class="form-control mb-4">
            <label class="label" for="productPrice">
              <span class="label-text font-medium">Price <span class="text-error">*</span></span>
            </label>
            <label class="input-group">
              <span>â‚±</span>
              <input
                id="productPrice"
                type="number"
                formControlName="price"
                placeholder="0.00"
                step="0.01"
                min="0.01"
                max="999999.99"
                class="input input-bordered w-full"
                [class.input-error]="hasError('price')"
              />
            </label>
            @if (getErrorMessage('price')) {
              <div class="label">
                <span class="label-text-alt text-error">{{ getErrorMessage('price') }}</span>
              </div>
            }
          </div>

          <!-- Type -->
          <div class="form-control mb-4">
            <label class="label" for="productType">
              <span class="label-text font-medium"
                >Product Type <span class="text-error">*</span></span
              >
            </label>
            <select
              id="productType"
              formControlName="type"
              class="select select-bordered"
              [class.select-error]="hasError('type')"
            >
              <option [ngValue]="ProductTypeEnum.Drink">Drink</option>
              <option [ngValue]="ProductTypeEnum.Food">Food</option>
              <option [ngValue]="ProductTypeEnum.Dessert">Dessert</option>
              <option [ngValue]="ProductTypeEnum.Other">Other</option>
            </select>
            @if (getErrorMessage('type')) {
              <div class="label">
                <span class="label-text-alt text-error">{{ getErrorMessage('type') }}</span>
              </div>
            }
          </div>

          <!-- Is Add-on -->
          <div class="form-control mb-4">
            <label class="label cursor-pointer justify-start gap-4">
              <input type="checkbox" formControlName="isAddOn" class="checkbox checkbox-primary" />
              <div>
                <span class="label-text font-medium">Is Add-on</span>
                <p class="text-base-content/60 text-sm">Mark this product as an add-on item</p>
              </div>
            </label>
          </div>

          <!-- Is Active -->
          <div class="form-control mb-6">
            <label class="label cursor-pointer justify-start gap-4">
              <input type="checkbox" formControlName="isActive" class="checkbox checkbox-primary" />
              <div>
                <span class="label-text font-medium">Active</span>
                <p class="text-base-content/60 text-sm">Only active products are visible</p>
              </div>
            </label>
          </div>

          <!-- Product Image -->
          <div class="form-control mb-6">
            <label class="label" for="productImage">
              <span class="label-text font-medium">Product Image</span>
              <span class="label-text-alt text-base-content/60"
                >Max 5MB - JPG, PNG, GIF, or WebP</span
              >
            </label>

            <!-- Current Image -->
            @if (currentImageUrl() && !imagePreview()) {
              <div class="mb-4">
                <p class="text-base-content/60 mb-2 text-sm">Current Image:</p>
                <img
                  [src]="currentImageUrl()"
                  alt="Current product image"
                  class="border-base-300 h-32 w-32 rounded-lg border object-cover"
                />
              </div>
            }

            <!-- Image Preview -->
            @if (imagePreview()) {
              <div class="mb-4">
                <p class="text-base-content/60 mb-2 text-sm">New Image Preview:</p>
                <div class="relative inline-block">
                  <img
                    [src]="imagePreview()"
                    alt="Image preview"
                    class="border-base-300 h-32 w-32 rounded-lg border object-cover"
                  />
                  <button
                    type="button"
                    class="btn btn-circle btn-sm btn-error absolute -top-2 -right-2"
                    (click)="removeImage()"
                    title="Remove image"
                  >
                    <app-icon name="icon-close" [class]="'h-4 w-4'"></app-icon>
                  </button>
                </div>
              </div>
            }

            <!-- File Input -->
            <input
              id="productImage"
              type="file"
              accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
              class="file-input file-input-bordered w-full"
              (change)="onFileSelected($event)"
              [disabled]="isUploading()"
            />

            @if (isUploading()) {
              <div class="mt-2 flex items-center gap-2">
                <span class="loading loading-spinner loading-sm"></span>
                <span class="text-sm">Uploading image...</span>
              </div>
            }
          </div>

          <!-- Actions -->
          <div class="card-actions justify-end">
            <button
              type="button"
              class="btn btn-ghost"
              (click)="navigateToList()"
              [disabled]="isSaving()"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="productForm.invalid || isSaving()"
            >
              @if (isSaving()) {
                <span class="loading loading-spinner loading-sm"></span>
              }
              {{ isEditMode() ? 'Update' : 'Create' }} Product
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
