<div class="flex h-full flex-col">
  <!-- Header with Filters -->
  <div class="mb-4 flex shrink-0 items-center gap-2">
    <!-- Search Input -->
    <label class="input input-sm outline-transparent">
      <app-icon name="icon-search" [class]="'h-[1em] opacity-50'" [fill]="'#000000'" />
      <input
        type="search"
        class="grow"
        placeholder="Search by product name"
        [formControl]="filterForm.controls.searchTerm"
      />
    </label>

    <!-- Category Filter Dropdown -->
    <app-filter-dropdown
      [title]="'Category'"
      [icon]="'icon-category'"
      [options]="typeOptions()"
      [selectedIds]="selectedTypes()"
      (filterChange)="onTypeFilterChange($event)"
      (filterReset)="onTypeFilterReset()"
    />

    <!-- Status Filter Dropdown -->
    <app-filter-dropdown
      [title]="'Status'"
      [icon]="'icon-status'"
      [options]="statusOptions()"
      [selectedIds]="selectedStatuses()"
      (filterChange)="onStatusFilterChange($event)"
      (filterReset)="onStatusFilterReset()"
    />

    <!-- Refresh Button -->
    <button
      class="btn btn-sm"
      type="button"
      (click)="refresh()"
      [disabled]="isRefreshing()"
      aria-label="Refresh products"
    >
      @if (isRefreshing()) {
        <span class="loading loading-spinner loading-xs"></span>
      } @else {
        <app-icon name="icon-refresh" [class]="'h-5 w-5'" [fill]="'currentColor'" />
      }
    </button>

    <!-- Add Product Button -->
    <button class="btn btn-sm btn-neutral ml-auto" (click)="navigateToEditor()">
      <app-icon name="icon-plus" [class]="'h-4 w-4'" />
      Add Product
    </button>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="flex justify-center py-8">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
  }

  <!-- Products Table -->
  @if (!isLoading()) {
    @if (products().length === 0) {
      <div class="bg-base-100 rounded-lg p-8 text-center">
        <p class="text-lg text-gray-500">No products found</p>
        <p class="text-sm text-gray-400">Try adjusting your filters or add a new product</p>
      </div>
    } @else {
      <div
        class="isolate min-h-0 flex-1 overflow-x-auto overflow-y-auto rounded-lg border border-gray-200"
      >
        <table class="table w-full">
          <thead class="bg-base-100 sticky top-0 z-10">
            <tr>
              <th class="w-12"></th>
              <th
                class="hover:bg-base-200 hover:bg-transition cursor-pointer text-left"
                (click)="toggleSort('name')"
              >
                <div class="flex items-center gap-1">
                  Name
                  @if (sortColumn() === 'name') {
                    <span>{{ sortDirection() === 'asc' ? '↑' : '↓' }}</span>
                  }
                </div>
              </th>
              <th class="text-left">Category</th>
              <th class="text-right">Price</th>
              <th class="text-center">Status</th>
              <th class="text-right">Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (product of sortedProducts(); track product.id) {
              <tr
                class="hover:bg-base-200 hover:bg-transition cursor-pointer"
                (click)="navigateToDetails(product.id)"
              >
                <td class="w-12">
                  @if (product.imageUrl) {
                    <img
                      [src]="product.imageUrl"
                      [alt]="product.name"
                      class="aspect-square h-10 w-10 rounded object-cover"
                    />
                  } @else {
                    <div class="flex h-10 w-10 items-center justify-center rounded bg-gray-100">
                      <app-icon
                        name="icon-box"
                        [class]="'h-5 w-5 text-gray-400'"
                        [fill]="'currentColor'"
                      />
                    </div>
                  }
                </td>
                <td class="font-medium">{{ product.name }}</td>
                <td>
                  <app-badge variant="default">{{
                    getProductCategoryName(product.category)
                  }}</app-badge>
                </td>
                <td class="text-right font-semibold">₱{{ product.price.toFixed(2) }}</td>
                <td class="text-center">
                  @if (product.isActive) {
                    <app-badge variant="success">Active</app-badge>
                  } @else {
                    <app-badge variant="error">Inactive</app-badge>
                  }
                </td>
                <td class="text-right">
                  <div class="flex justify-end gap-1">
                    <button
                      class="btn btn-sm btn-ghost"
                      (click)="navigateToEditor(product.id); $event.stopPropagation()"
                      title="Edit"
                    >
                      <app-icon name="icon-edit" [class]="'h-4 w-4'" />
                    </button>
                    <button
                      class="btn btn-sm btn-ghost text-error"
                      (click)="deleteProduct(product); $event.stopPropagation()"
                      title="Delete"
                    >
                      <app-icon name="icon-delete" [class]="'h-4 w-4'" />
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  }
</div>
