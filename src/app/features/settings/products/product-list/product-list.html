<div class="flex h-full flex-col">
  <!-- Header -->
  <div class="mb-6 flex shrink-0 items-center justify-between">
    <h1 class="text-3xl font-bold">Products</h1>
    <button class="btn btn-neutral" (click)="navigateToEditor()">
      <app-icon name="icon-plus" [class]="'mr-2 h-5 w-5'"></app-icon>
      Add Product
    </button>
  </div>

  <!-- Filters -->
  <div class="bg-base-100 mb-6 shrink-0 rounded-lg p-6 shadow-md">
    <h2 class="mb-4 text-lg font-semibold">Filters</h2>
    <form [formGroup]="filterForm" class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4">
      <!-- Search -->
      <div class="form-control">
        <label class="label" for="searchTerm">
          <span class="label-text">Search</span>
        </label>
        <input
          id="searchTerm"
          type="text"
          formControlName="searchTerm"
          placeholder="Search by name..."
          class="input input-bordered"
        />
      </div>

      <!-- Type Filter -->
      <div class="form-control">
        <label class="label" for="typeFilter">
          <span class="label-text">Type</span>
        </label>
        <select id="typeFilter" formControlName="type" class="select select-bordered">
          <option [ngValue]="null">All Types</option>
          <option [ngValue]="ProductTypeEnum.Drink">Drink</option>
          <option [ngValue]="ProductTypeEnum.Food">Food</option>
          <option [ngValue]="ProductTypeEnum.Dessert">Dessert</option>
          <option [ngValue]="ProductTypeEnum.Other">Other</option>
        </select>
      </div>

      <!-- Add-on Filter -->
      <div class="form-control">
        <label class="label" for="isAddOnFilter">
          <span class="label-text">Add-on</span>
        </label>
        <select id="isAddOnFilter" formControlName="isAddOn" class="select select-bordered">
          <option [ngValue]="null">All</option>
          <option [ngValue]="true">Yes</option>
          <option [ngValue]="false">No</option>
        </select>
      </div>

      <!-- Active Filter -->
      <div class="form-control">
        <label class="label" for="isActiveFilter">
          <span class="label-text">Status</span>
        </label>
        <select id="isActiveFilter" formControlName="isActive" class="select select-bordered">
          <option [ngValue]="null">All</option>
          <option [ngValue]="true">Active</option>
          <option [ngValue]="false">Inactive</option>
        </select>
      </div>
    </form>
    <div class="mt-4">
      <button type="button" class="btn btn-sm btn-ghost" (click)="clearFilters()">
        Clear Filters
      </button>
    </div>
  </div>

  <!-- Error Alert -->
  @if (error()) {
    <div class="alert alert-error mb-4 shrink-0">
      <app-icon name="icon-error" [class]="'h-6 w-6'"></app-icon>
      <span>{{ error() }}</span>
    </div>
  }

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="flex justify-center py-8">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
  }

  <!-- Products Table -->
  @if (!isLoading()) {
    @if (products().length === 0) {
      <div class="bg-base-100 rounded-lg p-8 text-center">
        <p class="text-lg text-gray-500">No products found</p>
        <p class="text-sm text-gray-400">Try adjusting your filters or add a new product</p>
      </div>
    } @else {
      <div
        class="isolate min-h-0 flex-1 overflow-x-auto overflow-y-auto rounded-lg border border-gray-200"
      >
        <table class="table w-full">
          <thead class="bg-base-100 sticky top-0 z-10">
            <tr>
              <th>Name</th>
              <th>Price</th>
              <th>Type</th>
              <th>Add-on</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (product of products(); track product.id) {
              <tr class="hover cursor-pointer" (click)="navigateToDetails(product.id)">
                <td class="font-medium">{{ product.name }}</td>
                <td>â‚±{{ product.price.toFixed(2) }}</td>
                <td>
                  <span class="badge badge-ghost">{{ getProductTypeName(product.type) }}</span>
                </td>
                <td>
                  @if (product.isAddOn) {
                    <span class="badge badge-info">Yes</span>
                  } @else {
                    <span class="badge badge-ghost">No</span>
                  }
                </td>
                <td>
                  @if (product.isActive) {
                    <span class="badge badge-success">Active</span>
                  } @else {
                    <span class="badge badge-error">Inactive</span>
                  }
                </td>
                <td>
                  <div class="flex gap-2">
                    <button
                      class="btn btn-sm btn-neutral"
                      (click)="navigateToEditor(product.id); $event.stopPropagation()"
                      title="Edit"
                    >
                      <app-icon name="icon-edit" [class]="'h-4 w-4'"></app-icon>
                    </button>
                    <button
                      class="btn btn-sm btn-ghost text-error"
                      (click)="deleteProduct(product); $event.stopPropagation()"
                      title="Delete"
                    >
                      <app-icon name="icon-delete" [class]="'h-4 w-4'"></app-icon>
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  }
</div>
